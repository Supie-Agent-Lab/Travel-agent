## **一个用于旅游路线推荐的、分层多代理动态用户偏好建模框架**

### **摘要 (Abstract)**

针对个性化旅游推荐系统中用户偏好静态、难以捕捉深层动机以及冷启动等问题，本文提出了一个创新的、基于大语言模型（LLM）的动态用户偏好建模框架。该框架通过**对话式交互**构建深度用户画像，并独创性地采用**随机扰动（Stochastic Perturbation）**机制生成多个子画像代理，以增强模型的鲁棒性与探索能力。我们设计了一种**分层评估（Hierarchical Evaluation）**方法，通过嵌套的、基于**Bradley-Terry模型**的成对比较，将抽象的“体验”指标进行量化。最终，框架不寻求单一的最优偏好模型，而是构建一个**多元代理委员会（Multi-Agent Committee）**，为用户提供一组代表其偏好多样性的高质量推荐。本技术路线旨在为解决个性化推荐中的不确定性和用户偏好动态性问题提供一个新的研究范式。

---

### **1. 框架概述 (Framework Overview)**

本框架包含两个核心阶段：
1.  **阶段一：偏好引出与模型拟合 (Preference Elicitation and Model Fitting)**：此阶段的目标是从零开始，通过与用户的单次深度交互，学习并构建一个代表该用户多面性偏好的“决策模型库”。
2.  **阶段二：多元代理推荐 (Multi-Agent Recommendation)**：此阶段应用已学习到的模型库，为用户未来的具体需求提供决策支持。

---

### **2. 阶段一：偏好引出与模型拟合**

此阶段通过一系列算法步骤，完成从原始对话到量化权重模型的转化。

#### **2.1. 对话式用户画像构建 (Conversational User Profiling)**
* **方法**: 利用一个经过指令微调的大语言模型（LLM）作为`对话代理`，与用户进行一次开放式的自然语言对话。
* **目标**: 对话旨在探查一个预定义的、四层结构的用户特征模型（`F`），该模型包含：`F_foundational`（基础事实），`F_behavioral`（行为偏好），`F_motivational`（深层动机），以及`F_contextual`（动态情境）。
* **输出**: 一个结构化（如JSON格式）的**核心用户画像 `P_core`**。

#### **2.2. 用户画像的随机扰动 (Stochastic Profile Perturbation)**
* **动机**: 为避免模型对核心画像`P_core`产生过拟合，并有效探索用户偏好的边界，我们引入了随机扰动机制，类似于神经网络中的Dropout。
* **方法**: 基于`P_core`，通过对非关键特征（如强、弱偏好）应用**加权随机丢失（Weighted Dropout）**策略，生成`k`个略有差异的**子用户画像 `{P_1, P_2, ..., P_k}`**。硬性约束（如预算、同行者构成）的丢失概率为0。
* **输出**: `k`个独立的`子用户画像代理`。

#### **2.3. 候选路线集的生成与向量化 (Candidate Itinerary Set Generation and Vectorization)**
* **方法**: 每个`子用户画像代理 P_k`，驱动一个`旅行代理`（LLM-based Agent），该代理结合内部知识与通过API调用的外部信息（如实时POI数据），生成`m`套候选旅行路线`{I_k1, I_k2, ..., I_km}`。
* **向量化**: 每条路线`I`在生成时，都必须被转化为一个量化的特征向量 `V_I = (T, M, E)`，其中：
    * `T` (Time): 通过调用地图API（如高德地图工具）计算出的总交通时间。
    * `M` (Money): 估算的总花费。
    * `E` (Experience): 一个多维度的体验向量 `(e_1, e_2, ...)`，其值由`旅行代理`在生成路线后，根据预设维度（如放松度、知识性等）对自身产出进行评估打分得到。

#### **2.4. 分层偏好引出 (Hierarchical Preference Elicitation)**
* **目标**: 为每个`子用户画像代理 P_k`，获取其对`m`套候选路线的量化奖励值`R`。
* **方法**: 采用一个两级嵌套的评估流程。
    1.  **内部评估 (Intra-Itinerary Evaluation)**:
        * 对每条路线`I_kj`中的`s`个景点`{attraction_1, ..., attraction_s}`，`代理 P_k`对其进行成对比较。
        * 应用**Bradley-Terry (BT)模型**于比较结果，为每个景点计算出体验分`score_s`。
        * 通过加权求和（权重`w`可由建议游玩时长等确定），计算出该路线总的**聚合体验分 `Experience_kj`**。`Experience_kj`是特征向量`V`中`E`的聚合标量表示。
    2.  **外部评估 (Inter-Itinerary Evaluation)**:
        * `代理 P_k`再对`m`套完整的候选路线`{I_k1, ..., I_km}`进行成对比较。
        * 再次应用**BT模型**，为每条路线计算出最终的**标量奖励值 `R_kj`**。

#### **2.5. 效用函数拟合 (Utility Function Fitting)**
* **目标**: 为每个`子用户画像代理 P_k`求解其偏好权重向量`W_k`。
* **方法**:
    * 定义效用函数，例如线性模型：`R = W_T * T + W_M * M + W_E * Experience`。
    * 对于`代理 P_k`，我们现在拥有了一组样本数据`{(R_kj, T_kj, M_kj, Experience_kj)}`。
    * 使用**普通最小二乘法 (Ordinary Least Squares, OLS)**或其他回归方法，对上述方程进行拟合，解出该代理的偏好权重向量`W_k = (W_T_k, W_M_k, W_E_k)`。
* **输出**: `k`组独立的权重向量`{W_1, W_2, ..., W_k}`，构成完整的用户决策模型库。

---

### **3. 阶段二：多元代理推荐**

此阶段应用已学习到的模型，响应用户新的旅行请求。

#### **3.1. 候选空间生成 (Candidate Space Generation)**
* 根据用户新需求，`旅行代理`利用外部API（如高德地图工具）大规模生成`n`（`n >> m`）个候选路线，并快速计算出每条路线的特征向量`V'_i = (T'_i, M'_i, E'_i)`。

#### **3.2. 并行效用计算 (Parallel Utility Calculation)**
* `k`个`子用户画像代理`分别载入其已学习到的权重向量`W_k`。
* 所有代理并行地对`n`个候选路线的特征向量`V'_i`进行计算，得出`k`组独立的效用（奖励）分数。

#### **3.3. 委员会选举与推荐 (Committee-based Selection and Recommendation)**
* 从每组打分结果中，选出得分最高的“冠军方案”。
* 最终，将这`k`个（或经过去重后的）冠军方案作为最终推荐集，呈现给用户。每个方案可附上其推荐代理的“视角”作为解释，例如“此方案最注重放松体验”或“此方案最能满足您对历史文化的好奇心”。

---
### **4. 总结与贡献 (Conclusion & Contributions)**
本框架的主要学术贡献在于：
1.  提出了一种结合LLM的**动态、对话式用户画像构建方法**。
2.  将**随机扰动（Dropout）**思想创新性地应用于用户画像，以提升偏好模型的鲁棒性。
3.  设计了一套**可解释的、分层的效用量化机制**，用于评估抽象的“体验”指标。
4.  构建了一个**多元代理推荐模型**，它不追求单一的最优解，而是接受并利用了用户偏好的不确定性，为用户提供更丰富、更有洞察力的决策支持。
